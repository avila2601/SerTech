import{Db as g,H as c,M as C,R as u,a as s,b as h,l,p as n,x as p}from"./chunk-QVS6JBII.js";var m=class d{constructor(a){this.http=a;this.loadData()}STORAGE_KEY="sertech_data";data={citas:[],clientes:[],ultimoIdCliente:0,ultimoIdCita:0};loadData(){let a=localStorage.getItem(this.STORAGE_KEY);if(a)try{this.data=JSON.parse(a)}catch(t){console.error("Error loading data from localStorage:",t)}}saveData(){try{localStorage.setItem(this.STORAGE_KEY,JSON.stringify(this.data))}catch(a){console.error("Error saving data to localStorage:",a)}}getClientes(){return this.http.get("http://localhost:3001/clientes")}agregarCliente(a){return this.http.get("http://localhost:3001/clientes").pipe(c(t=>{Array.isArray(t)||(t=[]);let e=t.length>0?(Math.max(...t.map(o=>+o.id))+1).toString():"1",i=h(s({},a),{id:e}),r=[...t,i];return this.http.put("http://localhost:3001/clientes",r).pipe(n(()=>i))}))}getClienteById(a){return this.data.clientes.find(t=>t.id===a)}actualizarCliente(a,t){return this.getClientes().pipe(c(e=>{let i=e.findIndex(v=>v.id===a);if(i===-1)return l(null);let r=s(s({},e[i]),t),o=[...e];return o[i]=r,this.http.put("http://localhost:3001/clientes",o).pipe(n(()=>r))}))}getCitas(){return this.http.get("http://localhost:3001/citas")}getCitasPorCliente(a){let t=this.data.citas.filter(e=>e.clienteId===a);return l(t)}crearCita(a){return this.getCitas().pipe(c(t=>{Array.isArray(t)||(t=[]);let e=t.length>0?(Math.max(...t.map(o=>+o.id))+1).toString():"1",i=h(s({},a),{id:e,estado:"Pendiente"}),r=[...t,i];return this.http.put("http://localhost:3001/citas",r).pipe(n(()=>i))}))}putCitasJson(){this.http.put("assets/data/citas.json",this.data).subscribe({next:()=>console.log("Archivo citas.json actualizado"),error:t=>console.error("Error al actualizar citas.json:",t)})}cancelarCita(a){let t=this.data.citas.findIndex(e=>e.id===a);t!==-1&&(this.data.citas[t].estado="Cancelada",this.saveData())}loadInitialData(){return this.http.get("assets/data/citas.json").pipe(n(a=>(this.data=a,this.saveData(),a)),p(a=>(console.error("Error loading initial data:",a),l(this.data))))}exportData(){return JSON.stringify(this.data,null,2)}clearData(){this.data={citas:[],clientes:[],ultimoIdCliente:0,ultimoIdCita:0},this.saveData()}static \u0275fac=function(t){return new(t||d)(u(g))};static \u0275prov=C({token:d,factory:d.\u0275fac,providedIn:"root"})};export{m as a};
